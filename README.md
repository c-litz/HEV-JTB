# HEV Transmission Model and Analysis

This repository contains MATLAB and R scripts for modeling Hepatitis E Virus (HEV) transmission dynamics and analyzing intervention strategies. The workflow includes simulation, result analysis, plotting, and sensitivity analysis.

---

## Overview of Scripts

### `run_HEV_model.m`
- Runs the HEV transmission model.
- Prompts the user to select an intervention (1 to 7).
- Saves simulation outputs locally for quick checks/plotting and saves data to a larger `.mat` file (`HEV_results_all.mat`) for use in other scripts.
- Saves sampled parameter sets into a `sensitivity_HEV_data.csv` file for sensitivity analysis in R.
- Creates a 'data' folder locally (if it doesn’t exist) to store output files.

### `analyze_HEV_results.m`
- Loads data from `HEV_results_all.mat`.
- Prompts the user to select a threshold trigger (1, 10, or 25) and interventions to compare.
- The first intervention choice should always be the baseline (enter `1`).
- Computes relative reductions in incidence metrics compared to the baseline.
- Appends results to the `sensitivity_HEV_data.csv` file for combined sensitivity analysis.
- Saves processed data for plotting to `HEV_results_plotting.mat` into the local 'data' folder.

### `plot_HEV_results.m`
- Loads data from the local output of `run_HEV_model.m` and `HEV_results_plotting.mat`.
- Prints a table showing trigger times (in weeks) for all interventions and thresholds.
- Creates a `figures` folder locally (if it doesn’t exist) for saving plots.
- Generates Figures 2, 3, and 4 from the publication and saves them into the local `figures` folder.

### `prcc_overall_HEV.R`
- Performs Partial Rank Correlation Coefficient (PRCC) sensitivity analysis using the `sensitivity_HEV_data.csv` file generated by MATLAB scripts.
- Generates Figure 5 from the publication.
- Saves Figure 5 PDF to the same local `figures` folder used by MATLAB outputs.

---

## Folder Structure and Usage Notes

- The repository **does not include** the `data` or `figures` folders.  
- These folders are **created locally** when you run the MATLAB scripts.
- The `data` folder stores generated `sensitivity_HEV_data.csv` and the three `.mat` files needed by the R scripts.
- The `figures` folder stores all PDF figure outputs from both MATLAB and R scripts.

### Important

1. **Run MATLAB scripts first:**  
   Before running the R script, ensure you have run `run_HEV_model.m` and `analyze_HEV_results.m` in MATLAB. This will generate the necessary `data` folder and `.csv` files required by the R scripts.

2. **R scripts expect the `data` folder and files to exist:**  
   The R scripts locate the `data` folder and files relative to their own location in the `scripts` folder. If the data files are missing, the R scripts will stop with an error message instructing you to run the MATLAB scripts first.

3. **Figure outputs:**  
   Both MATLAB and R save figures in a `figures` folder located at the repo root (alongside `scripts` and `data`). This folder is also created automatically if it doesn’t exist.

4. **Running scripts:**  
   - All scripts (MATLAB and R) are location within the `scripts` folder 
   - All scripts automatically detect their own location and build paths to the generated data and figures folders relative to that location.

---

## Dependencies

### MATLAB
- Statistics and Machine Learning Toolbox

### R
- `epiR`
- `sensitivity`
- (Optional) `rstudioapi` — improves script path detection when running interactively in RStudio

---

## Usage Summary

1. Run `run_HEV_model.m` in MATLAB to simulate HEV transmission under a chosen intervention.
2. Use `analyze_HEV_results.m` to compare interventions and thresholds, and generate summary data.
3. Run `plot_HEV_results.m` to visualize results and produce figures.
4. Run `prcc_overall_HEV.R` in R to perform sensitivity analysis and generate PRCC plots.

---

If you have any questions or issues, feel free to open an issue.

---

*Developed for Quantifying the Effect of Threshold-Triggered Interventions on Hepatitis E Virus Outbreaks: a preprint submitted to JTB*
